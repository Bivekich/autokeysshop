---
import Layout from '../../layouts/Layout.astro';
import StoryblokClient from 'storyblok-js-client'
// Initialize the client with the oauth token
const Storyblok = new StoryblokClient({
  accessToken: "aZO4rIbH4xJiemmkvqBb0gtt",
});
// 537160376
// export async function get({ request }) {
// 	const url = new URL(request.url);
// 	const id = url.searchParams.get('id');
// 	console.log(id)
// }
// console.log(url)
// Функция для получения товаров
async function fetchTovars() {
  const response = await Storyblok.get('cdn/stories', {
    version: 'published'
  });
  return response.data.stories;
}

// Функция для получения конкретного товара по ID
async function fetchTovar(id) {
  const response = await Storyblok.get(`cdn/stories/${id}`, {});
  return response.data.story.content;
}

// Функция для генерации путей на основе товаров
export async function getStaticPaths() {
  const tovars = await fetchTovars(); // Здесь мы вызываем fetchTovars для получения всех товаров

  return tovars.map((post) => ({
    params: { id: post.id.toString() }, // Убедитесь, что ID в виде строки
  }));
}




const { id } = Astro.params;

const tovar = await fetchTovar(537160376);





// console.log(tovars)
// console.log(tovar)
---


<Layout title="Auto Keys Shop - Согласие на обработку персональных данных">
	<main>
		<span class="tovar">
			Товар
		</span>
		<h3 class=full_name>
			{tovar.full_title}
		</h3>

		<div class="block">
			<div class="info">
				<h4>{tovar.short_title}</h4>
				<p>{tovar.first_desc}</p>
			</div>
			<img src={tovar.image1.filename}>
		</div>

		<div class="block">
			<img src={tovar.image2.filename}>
			<disv class="info">
				<span class=price_with_work>{tovar.price_with_work}</span>
				<p>{tovar.work_desc}</p>
			</div>
		</div>
	</main>
</Layout>

<style>
	main{
		max-width: 1000px;
		width: 100%;
		margin: auto;
	}
    .block{
		width: 100%;
		display: flex;
		flex-direction: row;
		flex-wrap: wrap;
		gap: 40px;
		margin: 70px 0;
	}
	.block img {
		max-width: 40%;
		width: 100%;
		min-width: 400px;
	}
	.info{
		display: flex;
		flex-direction: column;
		width: 50%;
	}
	.price_with_work{
		font-weight: 400;
		font-size: 20px;
		color: #fff;
		border-radius: 12px;
		background: #377dff;
		padding: 10px 15px;
		margin: 30px 0 60px 0;
	}
</style>